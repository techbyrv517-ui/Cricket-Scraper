{% extends 'frontend/base.html' %}

{% block title %}{{ category.meta_title or (category.short_name ~ ' - Live Scores, News & Updates | ' ~ settings.site_name) }}{% endblock %}

{% block meta %}
<meta name="description" content="{{ category.meta_description or category.description }}">
<meta name="keywords" content="{{ category.focus_keyword }}, {{ category.short_name }}, live score, cricket news, match updates">
<meta name="robots" content="index, follow">
<link rel="canonical" href="{{ category.canonical_url or (settings.site_url ~ '/category/' ~ category.slug) }}">

<meta property="og:type" content="website">
<meta property="og:title" content="{{ category.meta_title or category.short_name }}">
<meta property="og:description" content="{{ category.meta_description or category.description }}">
<meta property="og:url" content="{{ settings.site_url }}/category/{{ category.slug }}">
{% if category.og_image %}
<meta property="og:image" content="{{ category.og_image }}">
{% endif %}
<meta property="og:site_name" content="{{ settings.site_name }}">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ category.meta_title or category.short_name }}">
<meta name="twitter:description" content="{{ category.meta_description or category.description }}">
{% if category.og_image %}
<meta name="twitter:image" content="{{ category.og_image }}">
{% endif %}

<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    "name": "{{ category.hero_title or category.short_name }}",
    "description": "{{ category.meta_description or category.description }}",
    "url": "{{ settings.site_url }}/category/{{ category.slug }}",
    "mainEntity": {
        "@type": "ItemList",
        "name": "{{ category.short_name }} Articles",
        "numberOfItems": {{ posts|length }},
        "itemListElement": [
            {% for post in posts %}
            {
                "@type": "ListItem",
                "position": {{ loop.index }},
                "url": "{{ settings.site_url }}/post/{{ post.slug }}",
                "name": "{{ post.title }}"
            }{% if not loop.last %},{% endif %}
            {% endfor %}
        ]
    },
    "publisher": {
        "@type": "Organization",
        "name": "{{ settings.site_name }}",
        "url": "{{ settings.site_url }}"
    }
}
</script>
{% endblock %}

{% block content %}
<div class="category-hero">
    <div class="hero-content">
        <h1>{{ category.hero_title or category.short_name }}</h1>
        <p>{{ category.hero_description or category.description }}</p>
    </div>
</div>

<div class="category-container">
    <div class="main-content">
        <div class="posts-container">
            <h2>Latest {{ category.name }} News & Updates</h2>
            
            {% if posts %}
            <div class="posts-grid">
                {% for post in posts %}
                <article class="post-card">
                    <a href="/post/{{ post.slug }}" class="post-link">
                        {% if post.featured_image %}
                        <div class="post-image">
                            <img src="{{ post.featured_image }}" alt="{{ post.title }}" loading="lazy">
                        </div>
                        {% else %}
                        <div class="post-image post-image-placeholder">
                            <span>{{ category.name }}</span>
                        </div>
                        {% endif %}
                        <div class="post-content">
                            <h3>{{ post.title }}</h3>
                            {% if post.excerpt %}
                            <p>{{ post.excerpt }}</p>
                            {% endif %}
                            <span class="post-date">{{ post.created_at.strftime('%d %b %Y') if post.created_at else '' }}</span>
                        </div>
                    </a>
                </article>
                {% endfor %}
            </div>
            {% else %}
            <div class="no-posts">
                <p>No posts yet in this category. Check back soon for updates!</p>
            </div>
            {% endif %}
        </div>
        
        <div class="seo-main-box">
            <div class="seo-section">
                <h2>{{ category.short_name }} - Live Score Updates</h2>
                {% if category.content %}
                <div class="category-intro-text">
                    {{ category.content|safe }}
                </div>
                {% else %}
                <p>
                    Get the latest <strong>{{ category.short_name }}</strong> live cricket scores, ball-by-ball commentary, match schedule, and results. 
                    Follow {{ category.name }} matches with real-time updates on Cricbuzz Live Score.
                </p>
                <p>
                    The {{ category.short_name }} cricket rivalry is one of the most watched sporting events globally. 
                    Whether it's Test matches, ODIs, or T20s, every {{ category.name }} encounter brings intense competition and memorable moments.
                </p>
                <p>
                    Stay tuned for upcoming {{ category.short_name }} matches, player statistics, head-to-head records, and expert analysis. 
                    Never miss a moment of the action with our comprehensive coverage.
                </p>
                {% endif %}
            </div>
            
            <div class="seo-section">
                <h2>{{ category.name }} Head to Head</h2>
                <p>
                    The {{ category.short_name }} rivalry has produced some of the most memorable moments in cricket history. 
                    Both teams have shared intense battles across all formats of the game.
                </p>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-number">--</div>
                        <div class="stat-label">Test Matches</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number">--</div>
                        <div class="stat-label">ODI Matches</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number">--</div>
                        <div class="stat-label">T20I Matches</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <aside class="category-sidebar">
        <div class="sidebar-widget">
            <h3 class="sidebar-title">Latest Posts</h3>
            <div class="sidebar-posts">
                {% if sidebar_posts %}
                    {% for sp in sidebar_posts %}
                    <a href="/post/{{ sp.slug }}" class="sidebar-post-item">
                        {% if sp.featured_image %}
                        <img src="{{ sp.featured_image }}" alt="{{ sp.title }}" class="sidebar-post-img">
                        {% else %}
                        <div class="sidebar-post-img no-image"></div>
                        {% endif %}
                        <h4 class="sidebar-post-title">{{ sp.title }}</h4>
                    </a>
                    {% endfor %}
                {% else %}
                <div class="no-posts-msg">
                    <p>No posts yet</p>
                </div>
                {% endif %}
            </div>
        </div>
        
        <div class="sidebar-widget" style="margin-top: 20px;">
            <h3>All Categories</h3>
            <ul class="category-list">
                {% for cat in all_categories %}
                <li class="{{ 'active' if cat.id == category.id else '' }}">
                    <a href="/category/{{ cat.slug }}">{{ cat.name }}</a>
                </li>
                {% endfor %}
            </ul>
        </div>
    </aside>
</div>

<style>
.category-hero {
    padding: 30px 40px;
    margin: 0 auto;
    max-width: 1200px;
}
.hero-content {
    max-width: 800px;
}
.hero-content h1 {
    font-size: 1.6rem;
    margin-bottom: 8px;
    color: #1a1a2e;
}
.hero-content p {
    font-size: 0.95rem;
    color: #666;
    line-height: 1.5;
}
.category-container {
    display: grid;
    grid-template-columns: 1fr 300px;
    gap: 30px;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 40px 40px;
}
.posts-container {
    background: #fff;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    margin-top: 0;
    margin-bottom: 25px;
}
.posts-container h2 {
    font-size: 1.3rem;
    color: #1a1a2e;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 2px solid var(--primary-color, #046a38);
}
.seo-main-box {
    background: #fff;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    margin-bottom: 25px;
}
.seo-section {
    padding-bottom: 25px;
    margin-bottom: 25px;
    border-bottom: 1px solid #eee;
}
.seo-section:last-child {
    padding-bottom: 0;
    margin-bottom: 0;
    border-bottom: none;
}
.seo-section h2 {
    font-size: 1.4rem;
    color: #1a1a2e;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 2px solid var(--primary-color, #046a38);
}
.seo-section p {
    color: #555;
    line-height: 1.8;
    margin-bottom: 15px;
}
.seo-section p:last-of-type {
    margin-bottom: 0;
}
.category-intro-text {
    color: #555;
    line-height: 1.8;
}
.stats-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-top: 20px;
}
.stat-box {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
}
.stat-number {
    font-size: 32px;
    font-weight: 700;
    color: var(--primary-color, #046a38);
}
.stat-label {
    color: #666;
    font-size: 14px;
    margin-top: 5px;
}
.category-intro {
    background: #f8f9fa;
    padding: 25px;
    border-radius: 8px;
    margin-bottom: 30px;
    line-height: 1.7;
}
.posts-section h2 {
    font-size: 1.5rem;
    margin-bottom: 25px;
    color: #333;
}
.posts-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 25px;
}
.post-card {
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    transition: transform 0.2s, box-shadow 0.2s;
}
.post-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.12);
}
.post-link {
    text-decoration: none;
    color: inherit;
    display: block;
}
.post-image {
    height: 180px;
    overflow: hidden;
}
.post-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}
.post-image-placeholder {
    background: linear-gradient(135deg, #046a38 0%, #023d20 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    font-size: 1.1rem;
}
.post-content {
    padding: 20px;
}
.post-content h3 {
    font-size: 1.1rem;
    margin-bottom: 10px;
    color: #333;
    line-height: 1.4;
}
.post-content p {
    color: #666;
    font-size: 0.9rem;
    margin-bottom: 10px;
    line-height: 1.5;
}
.post-date {
    color: #999;
    font-size: 0.8rem;
}
.no-posts {
    text-align: center;
    padding: 60px 20px;
    background: #f8f9fa;
    border-radius: 8px;
    color: #666;
}
.category-sidebar {
    position: sticky;
    top: 80px;
    height: fit-content;
}
.sidebar-widget {
    background: white;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}
.sidebar-widget h3 {
    font-size: 1.1rem;
    margin-bottom: 15px;
    color: #333;
    border-bottom: 2px solid var(--primary-color, #046a38);
    padding-bottom: 10px;
}
.sidebar-title {
    font-size: 16px;
    font-weight: 600;
    color: #1a1a2e;
    margin: 0 0 15px 0;
    padding-bottom: 10px;
    border-bottom: 2px solid #046a38;
}
.sidebar-posts {
    display: flex;
    flex-direction: column;
    gap: 12px;
}
.sidebar-post-item {
    display: flex;
    flex-direction: column;
    text-decoration: none;
    color: #333;
    border-radius: 10px;
    overflow: hidden;
    transition: transform 0.2s, box-shadow 0.2s;
    background: #f9f9f9;
}
.sidebar-post-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}
.sidebar-post-img {
    width: 100%;
    height: 140px;
    object-fit: cover;
}
.sidebar-post-img.no-image {
    background: linear-gradient(135deg, #046a38 0%, #034d29 100%);
    height: 140px;
}
.sidebar-post-title {
    font-size: 14px;
    font-weight: 600;
    line-height: 1.4;
    padding: 12px;
    margin: 0;
    color: #1a1a2e;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}
.no-posts-msg {
    text-align: center;
    padding: 20px;
    color: #999;
}
.category-list {
    list-style: none;
    padding: 0;
    margin: 0;
}
.category-list li {
    margin-bottom: 8px;
}
.category-list li a {
    display: block;
    padding: 10px 12px;
    color: #333;
    text-decoration: none;
    border-radius: 4px;
    transition: background 0.2s;
}
.category-list li a:hover,
.category-list li.active a {
    background: var(--primary-color, #046a38);
    color: white;
}
@media (max-width: 900px) {
    .category-container {
        grid-template-columns: 1fr;
        padding: 0 20px 30px;
    }
    .category-hero {
        padding: 20px;
    }
    .hero-content h1 {
        font-size: 1.4rem;
    }
    .posts-grid {
        grid-template-columns: 1fr;
    }
    .stats-grid {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    .seo-main-box, .posts-container {
        padding: 20px;
    }
    .category-sidebar {
        position: static;
    }
}
</style>
{% endblock %}
