{% extends 'frontend/base.html' %}

{% block title %}{{ settings.get('site_name', 'Cricbuzz Live Score') }} - Live Cricket Scores, Match Updates{% endblock %}

{% block meta_description %}Get live cricket scores, match updates, schedules and results for India vs Pakistan, India vs Australia, India vs England and more. Your trusted source for cricket news.{% endblock %}

{% block content %}
<section class="hero">
    <div class="container">
        <h1>{{ settings.get('site_tagline', 'Live Cricket Scores, Match Updates & News') }}</h1>
        <p>Your trusted source for live cricket scores, match schedules, and results</p>
    </div>
</section>

<div class="container">
    <section class="matches-section">
        <div class="match-tabs">
            <button class="match-tab" onclick="showMatchTab('live')">Live</button>
            <button class="match-tab active" onclick="showMatchTab('recent')">Recent</button>
            <button class="match-tab" onclick="showMatchTab('upcoming')">Upcoming</button>
        </div>
        
        <div id="live" class="match-tab-content">
            <div class="matches-list" id="live-matches-list">
                <div class="no-matches" id="no-live-matches">
                    <div class="no-match-icon">üèè</div>
                    <p>No live matches at the moment</p>
                    <span>Check Recent or Upcoming matches</span>
                </div>
            </div>
        </div>
        
        <div id="recent" class="match-tab-content active">
            <div class="matches-list" id="recent-matches-list">
                {% if recent_matches %}
                    {% for match in recent_matches %}
                    <a href="/match-score/{{ match.match_id }}" class="cricbuzz-card">
                        <div class="card-header">
                            <span class="series-name">{{ match.series_name|upper if match.series_name else 'CRICKET MATCH' }}</span>
                            <span class="chevron">‚Ä∫</span>
                        </div>
                        <div class="card-body">
                            <div class="match-meta">
                                <span class="match-info-text">{{ match.match_info or '' }}{% if match.match_date %} ‚Ä¢ {{ match.match_date }}{% endif %}</span>
                            </div>
                            <div class="team-row">
                                {% if match.team1_flag %}
                                <img src="{{ match.team1_flag }}" alt="{{ match.team1_name }}" class="team-flag-img">
                                {% else %}
                                <div class="team-flag {{ match.team1_name|lower|replace(' ', '-') if match.team1_name else 'default' }}"></div>
                                {% endif %}
                                <span class="team-name">{{ match.team1_name or 'Team 1' }}</span>
                                <span class="team-score">{{ match.team1_score or '' }}</span>
                            </div>
                            <div class="team-row">
                                {% if match.team2_flag %}
                                <img src="{{ match.team2_flag }}" alt="{{ match.team2_name }}" class="team-flag-img">
                                {% else %}
                                <div class="team-flag {{ match.team2_name|lower|replace(' ', '-') if match.team2_name else 'default' }}"></div>
                                {% endif %}
                                <span class="team-name">{{ match.team2_name or 'Team 2' }}</span>
                                <span class="team-score bold">{{ match.team2_score or '' }}</span>
                            </div>
                            {% if match.result %}
                            <div class="match-result">{{ match.result }}</div>
                            {% endif %}
                        </div>
                    </a>
                    {% endfor %}
                {% else %}
                <div class="no-matches">
                    <div class="no-match-icon">üìä</div>
                    <p>No recent matches available</p>
                    <span>Scrape matches from admin panel</span>
                </div>
                {% endif %}
            </div>
            {% if has_more_recent %}
            <div id="load-more-container" style="text-align: center; padding: 20px;">
                <button id="load-more-btn" onclick="loadMoreMatches()" style="background: linear-gradient(135deg, #046a38 0%, #034d29 100%); color: #fff; border: none; padding: 12px 30px; border-radius: 25px; font-size: 14px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 15px rgba(4,106,56,0.3);">Load More Matches</button>
                <div id="loading-spinner" style="display: none; color: #046a38;">Loading...</div>
            </div>
            {% endif %}
        </div>
        
        <div id="upcoming" class="match-tab-content">
            <div class="matches-list">
                {% if upcoming_matches %}
                    {% for match in upcoming_matches %}
                    <a href="/cricket-match/{{ match.slug }}" class="cricbuzz-card upcoming">
                        <div class="card-header">
                            <span class="series-name">{{ match.series_name|upper if match.series_name else 'UPCOMING MATCH' }}</span>
                            <span class="chevron">‚Ä∫</span>
                        </div>
                        <div class="card-body">
                            <div class="match-meta">
                                <span class="match-info-text">{{ match.match_title }}</span>
                            </div>
                            <div class="upcoming-info">
                                <span class="upcoming-date">{{ match.match_date }}</span>
                            </div>
                        </div>
                    </a>
                    {% endfor %}
                {% else %}
                <div class="no-matches">
                    <div class="no-match-icon">üìÖ</div>
                    <p>No upcoming matches scheduled</p>
                    <span>Scrape matches from admin panel</span>
                </div>
                {% endif %}
            </div>
        </div>
    </section>
    
    <section style="margin-top: 40px;">
        <h2 class="section-title">Popular Matchups</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
            <a href="/match/india-vs-pakistan" class="match-card" style="text-decoration: none; color: inherit;">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #FF9933 50%, #046A38 50%); border-radius: 50%;"></div>
                    <div>
                        <h3 style="margin-bottom: 5px; color: var(--accent);">India vs Pakistan</h3>
                        <p style="color: #666; font-size: 14px;">The greatest rivalry in cricket</p>
                    </div>
                </div>
            </a>
            
            <a href="/match/india-vs-australia" class="match-card" style="text-decoration: none; color: inherit;">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #FF9933 50%, #FFCD00 50%); border-radius: 50%;"></div>
                    <div>
                        <h3 style="margin-bottom: 5px; color: var(--accent);">India vs Australia</h3>
                        <p style="color: #666; font-size: 14px;">Border-Gavaskar Trophy rivals</p>
                    </div>
                </div>
            </a>
            
            <a href="/match/india-vs-england" class="match-card" style="text-decoration: none; color: inherit;">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #FF9933 50%, #012169 50%); border-radius: 50%;"></div>
                    <div>
                        <h3 style="margin-bottom: 5px; color: var(--accent);">India vs England</h3>
                        <p style="color: #666; font-size: 14px;">Test cricket at its finest</p>
                    </div>
                </div>
            </a>
            
            <a href="/match/india-vs-new-zealand" class="match-card" style="text-decoration: none; color: inherit;">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #FF9933 50%, #000000 50%); border-radius: 50%;"></div>
                    <div>
                        <h3 style="margin-bottom: 5px; color: var(--accent);">India vs New Zealand</h3>
                        <p style="color: #666; font-size: 14px;">World Test Championship battles</p>
                    </div>
                </div>
            </a>
            
            <a href="/match/india-vs-south-africa" class="match-card" style="text-decoration: none; color: inherit;">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #FF9933 50%, #007A4D 50%); border-radius: 50%;"></div>
                    <div>
                        <h3 style="margin-bottom: 5px; color: var(--accent);">India vs South Africa</h3>
                        <p style="color: #666; font-size: 14px;">Freedom Trophy clashes</p>
                    </div>
                </div>
            </a>
            
            <a href="/match/india-vs-sri-lanka" class="match-card" style="text-decoration: none; color: inherit;">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #FF9933 50%, #8B0000 50%); border-radius: 50%;"></div>
                    <div>
                        <h3 style="margin-bottom: 5px; color: var(--accent);">India vs Sri Lanka</h3>
                        <p style="color: #666; font-size: 14px;">Subcontinent neighbors</p>
                    </div>
                </div>
            </a>
        </div>
    </section>
    
    <section style="margin-top: 50px; padding: 30px; background: #fff; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <h2 class="section-title">About Cricbuzz Live Score</h2>
        <p style="color: #555; line-height: 1.8; margin-bottom: 15px;">
            Welcome to <strong>Cricbuzz Live Score</strong> - your ultimate destination for live cricket scores, match updates, and comprehensive coverage of all international cricket matches. We bring you real-time updates for India vs Pakistan, India vs Australia, India vs England, and all major cricket matchups.
        </p>
        <p style="color: #555; line-height: 1.8; margin-bottom: 15px;">
            Whether you're following the intense <strong>Ind vs Pak</strong> rivalry, the competitive <strong>Ind vs Aus</strong> Border-Gavaskar Trophy, or the historic <strong>Ind vs Eng</strong> Test series, we've got you covered with ball-by-ball commentary, scorecards, and match highlights.
        </p>
        <p style="color: #555; line-height: 1.8;">
            Stay updated with live scores for T20 World Cup, ODI World Cup, IPL, Asia Cup, and all bilateral series. Track your favorite teams - India, Pakistan, Australia, England, New Zealand, South Africa, Sri Lanka, Bangladesh, Afghanistan, and West Indies.
        </p>
    </section>
</div>

<script>
function showMatchTab(tabId) {
    document.querySelectorAll('.match-tab-content').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.match-tab').forEach(el => el.classList.remove('active'));
    
    document.getElementById(tabId).classList.add('active');
    event.target.classList.add('active');
}
</script>
{% endblock %}

{% block extra_css %}
<style>
    .matches-section {
        margin-top: 30px;
        background: #fff;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    }
    
    .match-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 25px;
        border-bottom: 2px solid #e9ecef;
        padding-bottom: 15px;
    }
    
    .match-tab {
        padding: 10px 25px;
        border: none;
        background: #f8f9fa;
        color: #666;
        font-size: 14px;
        font-weight: 600;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .match-tab:hover {
        background: #e9ecef;
    }
    
    .match-tab.active {
        background: #046a38;
        color: #fff;
    }
    
    .match-tab-content {
        display: none;
    }
    
    .match-tab-content.active {
        display: block;
    }
    
    .matches-list {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    
    .cricbuzz-card {
        display: block;
        background: #fff;
        border-radius: 8px;
        overflow: hidden;
        text-decoration: none;
        box-shadow: 0 1px 4px rgba(0,0,0,0.1);
        transition: all 0.3s;
        border: 1px solid #e9ecef;
    }
    
    .cricbuzz-card:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        transform: translateY(-2px);
    }
    
    .cricbuzz-card.live-card {
        border-left: 4px solid #e53935;
    }
    
    .live-badge {
        background: linear-gradient(135deg, #e53935 0%, #c62828 100%);
        color: #fff;
        font-size: 10px;
        font-weight: 700;
        padding: 3px 8px;
        border-radius: 4px;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
    }
    
    .live-dot {
        display: inline-block;
        width: 8px;
        height: 8px;
        background: #e53935;
        border-radius: 50%;
        margin-right: 6px;
        animation: blink 1.5s infinite;
    }
    
    @keyframes blink {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.3; }
    }
    
    .live-status {
        color: #e53935 !important;
        font-weight: 600;
    }
    
    .team-flag-img {
        width: 24px;
        height: 16px;
        object-fit: cover;
        border-radius: 2px;
        margin-right: 10px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }
    
    .card-header {
        background: linear-gradient(135deg, #1a5f4c, #2d7a5e);
        color: #fff;
        padding: 12px 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .series-name {
        font-size: 13px;
        font-weight: 600;
        letter-spacing: 0.5px;
    }
    
    .chevron {
        font-size: 20px;
        opacity: 0.8;
    }
    
    .card-body {
        padding: 15px;
    }
    
    .match-meta {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 12px;
        color: #666;
        margin-bottom: 12px;
    }
    
    .live-dot {
        width: 8px;
        height: 8px;
        background: #ff4444;
        border-radius: 50%;
        animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }
    
    .match-info-text {
        color: #555;
    }
    
    .team-row {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 0;
        border-bottom: 1px solid #f0f0f0;
    }
    
    .team-row:last-of-type {
        border-bottom: none;
    }
    
    .team-flag {
        width: 24px;
        height: 16px;
        border-radius: 2px;
        background-size: cover;
        background-position: center;
    }
    
    .team-flag.ind, .team-flag.india { background: linear-gradient(180deg, #FF9933 33%, #fff 33%, #fff 66%, #138808 66%); }
    .team-flag.nz, .team-flag.new-zealand { background: linear-gradient(135deg, #000 40%, #fff 40%); }
    .team-flag.aus, .team-flag.australia { background: linear-gradient(135deg, #00008B 50%, #FFD700 50%); }
    .team-flag.eng, .team-flag.england { background: linear-gradient(to right, #fff 45%, #C8102E 45%, #C8102E 55%, #fff 55%); }
    .team-flag.pak, .team-flag.pakistan { background: linear-gradient(90deg, #fff 25%, #01411C 25%); }
    .team-flag.sa, .team-flag.south-africa { background: linear-gradient(135deg, #007A4D 50%, #FFB612 50%); }
    .team-flag.sl, .team-flag.sri-lanka { background: linear-gradient(135deg, #8B0000 50%, #FFD700 50%); }
    .team-flag.ban, .team-flag.bangladesh { background: linear-gradient(135deg, #006A4E 60%, #F42A41 60%); }
    .team-flag.afg, .team-flag.afghanistan { background: linear-gradient(180deg, #000 33%, #C8102E 33%, #C8102E 66%, #009E49 66%); }
    .team-flag.wi, .team-flag.west-indies { background: linear-gradient(135deg, #7B0041 50%, #FFC72C 50%); }
    .team-flag.default { background: #ddd; }
    
    .team-name {
        flex: 1;
        font-size: 14px;
        font-weight: 500;
        color: #333;
    }
    
    .team-score {
        font-size: 14px;
        font-weight: 600;
        color: #333;
    }
    
    .team-score.bold {
        font-weight: 700;
    }
    
    .match-result {
        margin-top: 10px;
        font-size: 13px;
        color: #046a38;
        font-weight: 500;
    }
    
    .upcoming-info {
        padding: 10px 0;
        text-align: center;
    }
    
    .upcoming-date {
        font-size: 14px;
        color: #2196F3;
        font-weight: 500;
    }
    
    .no-matches {
        text-align: center;
        padding: 50px 20px;
        color: #888;
    }
    
    .no-match-icon {
        font-size: 50px;
        margin-bottom: 15px;
    }
    
    .no-matches p {
        font-size: 16px;
        font-weight: 600;
        color: #555;
        margin-bottom: 5px;
    }
    
    .no-matches span {
        font-size: 13px;
    }
    
    @media (max-width: 768px) {
        .match-tabs {
            justify-content: center;
        }
        
        .match-tab {
            padding: 8px 18px;
            font-size: 13px;
        }
        
        .card-header {
            padding: 10px 12px;
        }
        
        .series-name {
            font-size: 11px;
        }
    }
    
    #load-more-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(4,106,56,0.4);
    }
</style>

<script>
let currentOffset = 10;
let isLoading = false;
let hasMore = {{ 'true' if has_more_recent else 'false' }};

function loadMoreMatches() {
    if (isLoading || !hasMore) return;
    
    isLoading = true;
    const btn = document.getElementById('load-more-btn');
    const spinner = document.getElementById('loading-spinner');
    
    btn.style.display = 'none';
    spinner.style.display = 'block';
    
    fetch(`/api/recent-matches?offset=${currentOffset}&limit=10`)
        .then(response => response.json())
        .then(data => {
            const matchesList = document.getElementById('recent-matches-list');
            
            data.matches.forEach(match => {
                const card = document.createElement('a');
                card.href = `/match-score/${match.match_id}`;
                card.className = 'cricbuzz-card';
                
                const team1Flag = match.team1_name ? match.team1_name.toLowerCase().replace(/ /g, '-') : 'default';
                const team2Flag = match.team2_name ? match.team2_name.toLowerCase().replace(/ /g, '-') : 'default';
                
                card.innerHTML = `
                    <div class="card-header">
                        <span class="series-name">${(match.series_name || 'CRICKET MATCH').toUpperCase()}</span>
                        <span class="chevron">‚Ä∫</span>
                    </div>
                    <div class="card-body">
                        <div class="match-meta">
                            <span class="match-info-text">${match.match_info || ''}${match.match_date ? ' ‚Ä¢ ' + match.match_date : ''}</span>
                        </div>
                        <div class="team-row">
                            <div class="team-flag ${team1Flag}"></div>
                            <span class="team-name">${match.team1_name || 'Team 1'}</span>
                            <span class="team-score">${match.team1_score || ''}</span>
                        </div>
                        <div class="team-row">
                            <div class="team-flag ${team2Flag}"></div>
                            <span class="team-name">${match.team2_name || 'Team 2'}</span>
                            <span class="team-score bold">${match.team2_score || ''}</span>
                        </div>
                        ${match.result ? `<div class="match-result">${match.result}</div>` : ''}
                    </div>
                `;
                matchesList.appendChild(card);
            });
            
            currentOffset += data.matches.length;
            hasMore = data.has_more;
            
            if (hasMore) {
                btn.style.display = 'inline-block';
            } else {
                document.getElementById('load-more-container').style.display = 'none';
            }
            
            spinner.style.display = 'none';
            isLoading = false;
        })
        .catch(error => {
            console.error('Error loading matches:', error);
            btn.style.display = 'inline-block';
            spinner.style.display = 'none';
            isLoading = false;
        });
}

function fetchLiveMatches() {
    fetch('/api/live-matches')
        .then(response => response.json())
        .then(data => {
            const liveList = document.getElementById('live-matches-list');
            const noLive = document.getElementById('no-live-matches');
            const refreshInfo = document.getElementById('live-refresh-info');
            
            liveList.innerHTML = '';
            
            if (data.matches && data.matches.length > 0) {
                noLive.style.display = 'none';
                refreshInfo.style.display = 'block';
                
                data.matches.forEach(match => {
                    const card = document.createElement('a');
                    card.href = `/match-score/${match.match_id}`;
                    card.className = 'cricbuzz-card live-card';
                    
                    const team1FlagHtml = match.team1_flag 
                        ? `<img src="${match.team1_flag}" class="team-flag-img" alt="${match.team1_name}">` 
                        : `<div class="team-flag ${match.team1_name ? match.team1_name.toLowerCase().replace(/ /g, '-') : 'default'}"></div>`;
                    const team2FlagHtml = match.team2_flag 
                        ? `<img src="${match.team2_flag}" class="team-flag-img" alt="${match.team2_name}">` 
                        : `<div class="team-flag ${match.team2_name ? match.team2_name.toLowerCase().replace(/ /g, '-') : 'default'}"></div>`;
                    
                    card.innerHTML = `
                        <div class="card-header">
                            <span class="series-name">${(match.series_name || 'LIVE MATCH').toUpperCase()}</span>
                            <span class="live-badge">LIVE</span>
                        </div>
                        <div class="card-body">
                            <div class="match-meta">
                                <span class="live-dot"></span>
                                <span class="match-info-text">${match.match_info || match.match_title || ''}</span>
                            </div>
                            <div class="team-row">
                                ${team1FlagHtml}
                                <span class="team-name">${match.team1_name || 'Team 1'}</span>
                                <span class="team-score">${match.team1_score || ''}</span>
                            </div>
                            <div class="team-row">
                                ${team2FlagHtml}
                                <span class="team-name">${match.team2_name || 'Team 2'}</span>
                                <span class="team-score bold">${match.team2_score || ''}</span>
                            </div>
                            ${match.match_status ? `<div class="match-result live-status">${match.match_status}</div>` : ''}
                        </div>
                    `;
                    liveList.appendChild(card);
                });
            } else {
                liveList.appendChild(noLive);
                noLive.style.display = 'block';
                refreshInfo.style.display = 'none';
            }
        })
        .catch(error => {
            console.error('Error fetching live matches:', error);
        });
}

fetchLiveMatches();
</script>
{% endblock %}
