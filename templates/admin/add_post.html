{% extends 'admin.html' %}

{% block main_content %}
<div class="content-header">
    <h1>Add New Post</h1>
    <a href="{{ url_for('admin_posts') }}" class="btn btn-secondary">Back to Posts</a>
</div>

<div class="card">
    <form method="POST" enctype="multipart/form-data" class="post-form" id="postForm">
        <div class="form-section">
            <h3>Basic Information</h3>
            <div class="form-grid">
                <div class="form-group full-width">
                    <label for="title">Post Title *</label>
                    <input type="text" id="title" name="title" required placeholder="Enter post title">
                </div>
                
                <div class="form-group">
                    <label for="category_id">Category *</label>
                    <select id="category_id" name="category_id" required>
                        <option value="">Select Category</option>
                        {% for cat in categories %}
                        <option value="{{ cat.id }}">{{ cat.name }} - {{ cat.short_name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Featured Image</label>
                    <div class="image-upload-options">
                        <div class="upload-tabs">
                            <button type="button" class="tab-btn active" data-tab="upload">Upload Image</button>
                            <button type="button" class="tab-btn" data-tab="url">Image URL</button>
                        </div>
                        <div class="tab-content" id="upload-tab">
                            <input type="file" id="featured_image_file" name="featured_image_file" accept="image/*" class="file-input">
                            <small>Max size: 16MB. Formats: JPG, PNG, GIF, WebP</small>
                        </div>
                        <div class="tab-content" id="url-tab" style="display: none;">
                            <input type="url" id="featured_image" name="featured_image" placeholder="https://example.com/image.jpg">
                            <small>Enter external image URL</small>
                        </div>
                        <div id="image-preview" class="image-preview"></div>
                    </div>
                </div>
                
                <div class="form-group full-width">
                    <label for="excerpt">Excerpt (Short Description)</label>
                    <textarea id="excerpt" name="excerpt" rows="2" placeholder="Brief description for sidebar display (max 160 characters)"></textarea>
                </div>
                
                <div class="form-group full-width">
                    <label for="content">Content</label>
                    <div id="quill-editor"></div>
                    <input type="hidden" id="content" name="content">
                </div>
            </div>
        </div>
        
        <div class="form-section">
            <h3>Advanced SEO Settings</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label for="focus_keyword">Focus Keyword</label>
                    <input type="text" id="focus_keyword" name="focus_keyword" placeholder="e.g., India vs Pakistan live score">
                    <small>Primary keyword to optimize for</small>
                </div>
                
                <div class="form-group">
                    <label for="meta_title">Meta Title (SEO)</label>
                    <input type="text" id="meta_title" name="meta_title" placeholder="SEO title for search engines (50-60 chars)" maxlength="70">
                    <small id="meta_title_count">0/70 characters</small>
                </div>
                
                <div class="form-group full-width">
                    <label for="meta_description">Meta Description (SEO)</label>
                    <textarea id="meta_description" name="meta_description" rows="2" placeholder="SEO description for search engines (150-160 chars)" maxlength="170"></textarea>
                    <small id="meta_desc_count">0/170 characters</small>
                </div>
                
                <div class="form-group">
                    <label for="canonical_url">Canonical URL</label>
                    <input type="url" id="canonical_url" name="canonical_url" placeholder="https://cricbuzz-live-score.com/post/your-post">
                    <small>Leave empty for auto-generated URL</small>
                </div>
                
                <div class="form-group">
                    <label for="og_image">OG Image URL (Social Sharing)</label>
                    <input type="url" id="og_image" name="og_image" placeholder="https://example.com/social-image.jpg">
                    <small>Image for social media (1200x630 recommended)</small>
                </div>
            </div>
        </div>
        
        <div class="form-section">
            <h3>Publishing</h3>
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="is_published" checked>
                    <span>Publish immediately</span>
                </label>
            </div>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Create Post</button>
            <a href="{{ url_for('admin_posts') }}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>

<style>
.post-form {
    max-width: 100%;
}
.form-section {
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 1px solid #eee;
}
.form-section h3 {
    margin-bottom: 20px;
    color: #333;
    font-size: 18px;
}
.form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}
.form-grid .full-width {
    grid-column: 1 / -1;
}
.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 500;
}
.form-group input, .form-group textarea, .form-group select {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 14px;
}
.form-group select {
    background: #fff;
    cursor: pointer;
}
.form-group small {
    color: #666;
    font-size: 12px;
    margin-top: 4px;
    display: block;
}
.checkbox-label {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
}
.form-actions {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}
.image-upload-options {
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 15px;
}
.upload-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
}
.tab-btn {
    padding: 8px 16px;
    border: 1px solid #ddd;
    background: #f8f9fa;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
}
.tab-btn.active {
    background: #046a38;
    color: white;
    border-color: #046a38;
}
.file-input {
    padding: 10px;
    border: 2px dashed #ddd;
    border-radius: 4px;
    background: #f8f9fa;
}
.image-preview {
    margin-top: 10px;
}
.image-preview img {
    max-width: 200px;
    max-height: 150px;
    border-radius: 4px;
    object-fit: cover;
}
#quill-editor {
    height: 350px;
    background: #fff;
    border-radius: 0 0 4px 4px;
}
.ql-toolbar {
    border-radius: 4px 4px 0 0;
    background: #f8f9fa;
}
@media (max-width: 768px) {
    .form-grid {
        grid-template-columns: 1fr;
    }
}
</style>

<script>
var quill = new Quill('#quill-editor', {
    theme: 'snow',
    placeholder: 'Write your post content here...',
    modules: {
        toolbar: [
            [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
            [{ 'font': [] }],
            [{ 'size': ['small', false, 'large', 'huge'] }],
            ['bold', 'italic', 'underline', 'strike'],
            [{ 'color': [] }, { 'background': [] }],
            [{ 'script': 'sub'}, { 'script': 'super' }],
            [{ 'list': 'ordered'}, { 'list': 'bullet' }],
            [{ 'indent': '-1'}, { 'indent': '+1' }],
            [{ 'direction': 'rtl' }],
            [{ 'align': [] }],
            ['link', 'image', 'video'],
            ['blockquote', 'code-block'],
            ['clean']
        ]
    }
});

document.getElementById('postForm').addEventListener('submit', function(e) {
    document.getElementById('content').value = quill.root.innerHTML;
});

document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        
        const tab = this.dataset.tab;
        document.getElementById('upload-tab').style.display = tab === 'upload' ? 'block' : 'none';
        document.getElementById('url-tab').style.display = tab === 'url' ? 'block' : 'none';
    });
});

document.getElementById('featured_image_file').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('image-preview').innerHTML = '<img src="' + e.target.result + '" alt="Preview">';
        };
        reader.readAsDataURL(file);
    }
});

document.getElementById('featured_image').addEventListener('input', function() {
    const url = this.value;
    if (url) {
        document.getElementById('image-preview').innerHTML = '<img src="' + url + '" alt="Preview" onerror="this.style.display=\'none\'">';
    }
});

document.getElementById('meta_title').addEventListener('input', function() {
    document.getElementById('meta_title_count').textContent = this.value.length + '/70 characters';
});
document.getElementById('meta_description').addEventListener('input', function() {
    document.getElementById('meta_desc_count').textContent = this.value.length + '/170 characters';
});
</script>
{% endblock %}
